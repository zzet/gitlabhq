- entities.each do |relation|
  %li{ class: "#{dom_class(relation)} js-toggle-container", id: dom_id(relation) }
    - user = relation.entity
    - available_options = User.watched_titles
    - options = relation.options.any? ? (User.watched_sources & relation.options.map {|o| o.to_sym }) : User.watched_sources
    .summary-entity-actions.pull-right
      = link_to "#", class: "btn-tiny btn js-toggle-button", title: 'Edit access level' do
        Edit
      = link_to profile_summary_user_path(summary.id, relation.id), class: "btn-tiny btn btn-danger", data: { confirm: "You are shure?" }, method: :delete do
        Remove
    .summary-entity-name
      = link_to user.name, user_path(user.username)
    .summary-entity-info
      = options.map {|o| available_options[o] }.join(", ")
      .edit-member.hide.js-toggle-content
        = form_for relation, url: profile_summary_user_path(summary, relation), method: :put do |f|
          - available_options.each do |key, val|
            = f.check_box :options, { multiple: true, checked: (options.include?(key) || options.empty?) }, key
            = val
            %br
          = f.submit 'Save', class: 'btn btn-save'
          %br
